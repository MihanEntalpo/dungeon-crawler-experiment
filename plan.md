# Архитектура проекта

## 1. Общая информация

* Проект представляет собой браузерную игру на html + css + js
* Проект пишется по возможности без зависимостей от сторонних библиотек, на базе возможностей VanillaJS
* Проект не использует TypeScript, компиляторов, js/css фреймворков
* Модульность проекта обеспечивается тем, что в файл index.html через тэги <script></script> в начале подгружаются все отдельные файлы проекта
* Для ООП используются обычные классы JavaScript
* Для сохранения состояния игры используется библиотека localForage

## 2. Функциональность игры

Игра состоит из нескольких базовых режимов:

### 2.1. Главное меню при запуске игры

В главном меню можно:

* Создать новую игру
* Просмотреть список сохранённых игр, их может быть не более трёх
* Загрузить одну из сохранённых игр

### 2.2. Собственно игра

#### 2.2.1. Общее описание

* Представляет собой Dungeon Crawler с видом сверху (без наклона камеры, чётко сверху)
* Карта состоит из тайлов
* Персонаж, NPC, враги перемещаются плавно, не скачками по ячейкам, а по пиксельно
* Персонаж, NPC, враги могут вращаться вокруг своей оси
* Тайлы, которые пользователь ещё ни разу не видел - скрыты черными тайлами сверху
* Видимость тайлов определяется направлением взгляда игрока
* Игрок управляется клавиатурой и мышью, клавиши AWSD (или ФЦЫВ в русской раскладке) позволяют ему перемещаться в 4-х направлениях, мышка указывает его направление поворота, и направление взгляда и атаки
* В игре единая большая карта, в ней отдельных "локаций" для перехода между которыми происходила бы подгрузка, весь мир - это единая карта. 
    * Технически, удалённые локации могут быть выгружены из памяти пока они слишкмо далеко, и подгружаться по мере необходимости, но для пользователя это должно быть незаметно.

#### 2.2.2. Архитектура классов

##### Картинка, класс Image - все картинки в игре хранятся в глобальном массиве all_images, добавляются туда с помощью функции add_image(...)
* Уникальное наименование изображения
* Определяет свои размеры
* Определяет тип источника:
    * base64-строка
    * url
    * тайлсет
* Данные base64-строки, если надо
* url, если надо
* имя объекта тайлсета (из общего списка тайлсетов игры), если надо
* название картинки внутри тайлсета, если надо

##### Тайлсет (набор тайлов в виде картинки), класс TileSet - все тайлсеты лежат в глобальном массиве all_tilesets
* Уникальное имя тайлсета
* Имя объекта изображения, взятого за основу (из общего списка изображений игры)
* Список координат и имён картинок внутри тайлсета

##### Анимация, класс Animation - все анимации лежат в глобальном массиве animations
* Уникальное наименование анимации
* Количество кадров
* Базовая скорость (кадров в секунду), по умолчанию 2
* Список кадров

##### Базовая сущность рисования, класс Drawer:
* Определяет тип рисования чего-либо:
    * Просто цвет
    * Картинка (текстура)
    * Анимация
* Цвет (если рисование просто цветом)
* Имя объекта Image из списка изображений (если рисование изображением)
* Анимация, если тип рисования - анимация
* Прозрачность 
* Угол поворота

##### Класс тайла карты MapTile:
* проходим ли этот тайл
* если проходим то с какой скоростью (например если это болото - то медленнее)
* можно ли с ним взаимодействовать (например, это дверь)
* пропускает ли он свет (можно ли смотреть сквозь него, если можно - то глядя через него можно развеевать туман войны за ним)
* объект класса Drawer, определяющий как рисовать этот тайл
* функция вызываемая при взаимодействии
* кастомные свойства (js-объект)

##### Наследуемые классы тайлов карты:

Например:

* FogTile - ячейка "тумана" - по умолчанию чёрная ячейка, которая отрисовывается там где ячейки невидимы глазу игрока
* DungeonWallTile - ячейка стены лабиринта
* DungeonFloorTile - ячейка пола лабиринта
* DungeonWoodDoorTile - ячейка деревянной двери лабиринта
* TownWallTile - ячейка городской стены
* TownWoodBuildingTile - ячейка деревянной стены городского дома
* TownGrassTile - ячейка травы в городе
* TownRoadTile - ячейка дороги в городе

Каждая из этих ячеек отличается свойствами, способом отрисовки и т.д.


